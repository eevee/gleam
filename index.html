<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf8">
    <title>GLEAM visual novel creator</title>
    <link rel="stylesheet" type="text/css" href="editor.css">
    <link rel="stylesheet" type="text/css" href="player.css">
    <script src="gleam-player.js"></script>
    <script src="gleam-editor.js"></script>
</head>
<body>
<main id="gleam-editor-launcher">
    <header><h1><span class="gleam-title">GLEAM</span> visual novel creator v0.2</h1></header>
    <section id="gleam-editor-load">
        <h1>Load project</h1>
        <ul id="gleam-editor-projects-list">
            <li><button type="button">
                <span class="-title">Circlet of the Sun</span>
                <span class="-subtitle"></span>
                <span class="-author"></span>
                <span class="-filesize">xx bytes</span>
                <span class="-beats">xx beats</span>
                <span class="-date">published 2019-09-22</span>
            </button></li>
        </ul>
    </section>
    <section id="gleam-editor-new">
        <h1>Create a project</h1>
        <form>
            <dl id="gleam-editor-new-form">
                <dt>Title</dt>
                <dd><input type="text" name="title"></dd>
                <dt>Subtitle (optional)</dt>
                <dd><input type="text" name="subtitle"></dd>
                <dt>Author</dt>
                <dd><input type="text" name="author"></dd>
                <dt>Size</dt>
                <dd>
                    <input type="text" name="width" inputmode="numeric" pattern="\d+" size="5"> × <input type="text" name="width" inputmode="numeric" size="5">
                    <br>
                    <button type="button">800×600</button>
                    <button type="button">1280×720</button>
                    <br>
                    <div class="gleam-editor-size-preview">
                        <div class="-screen">
                            <div class="-browser">
                                <div class="-viewport">
                                </div>
                            </div>
                        </div>
                        <div class="-vn"></div>
                    </div>
                </dd>
                <dd><button type="submit" class="gleam-big-button">Create</button>
            </dl>
        </form>
    </section>
    <section id="gleam-editor-intro">
        <h1>What is this?</h1>
        <p>Good question.</p>
    </section>
</main>
<main hidden id="gleam-editor-main">
    <header>
        <h1><span class="gleam-title">GLEAM</span> visual novel creator v0.2</h1>
        <div id="gleam-editor-header-metadata">
            <h2></h2>
            <h3></h3>
        </div>
        <nav id="gleam-editor-toolbar">
            <button type="button" disabled>Undo</button>
            <button type="button" disabled>Redo</button>
            <button type="button" disabled>Change stage size</button>
            <output>heavily modified!</output>
            <button type="button" disabled>Save copy</button>
            <button type="button" disabled>Close</button>
        </nav>
    </header>
    <section class="gleam-editor-panel" id="gleam-editor-player">
        <div class="gleam-editor-panel-body">
        </div>
    </section>
    <section class="gleam-editor-panel" id="gleam-editor-roles">
        <header>
            <h1>Roles</h1>
            <nav></nav>
        </header>
        <div class="gleam-editor-panel-body">
            <ol class="gleam-editor-roles">
            </ol>
        </div>
    </section>
    <section class="gleam-editor-panel" id="gleam-editor-assets">
        <header><h1>Assets</h1></header>
        <div class="gleam-editor-panel-body">
            <div id="gleam-editor-assets-source"></div>
            <div id="gleam-editor-asset-hint" class="gleam-editor-hint">
                Put all your assets (images, music, etc.) in a directory, then drag that directory here to use them!
            </div>
            <!--
                <input type="file" webkitdirectory>
            -->
            <ol class="gleam-editor-assets">
            </ol>
        </div>
    </section>
    <section class="gleam-editor-panel" id="gleam-editor-script">
        <header>
            <h1>Script</h1>
            <nav></nav>
        </header>
        <div class="gleam-editor-panel-body">
            <ol class="gleam-editor-beats-list">
            </ol>
            <!-- TODO waterfall view?  see what the state of anything is at any point? -->
        </div>
        <footer>
            <!-- state of selected beat goes here -->
        </footer>
    </section>
</main>
    <script>
        // FIXME give a real api for this.  question is, how do i inject into the editor AND the player
        window.addEventListener('load', ev => {
            let launcher = Gleam.attach_editor();
            //launcher.load_from_url('res/species-lunekos/');

            /*
            // TODO i guess this needs some ui
            let json = window.localStorage.getItem('gleam-temp');
            let script;
            if (json) {
                // TODO error handling here, probably
                script = Gleam.MutableScript.from_json(JSON.parse(json));
            }
            else {
                script = new Gleam.MutableScript;
                script.add_role(new Gleam.Stage('stage'));
            }
            editor.load_script(script, new Gleam.NullAssetLibrary);
            return;
            //*/

            // NOTE TO FUTURE GIT SPELUNKERS: sorry this exists only on my filesystem and points to all the old flora vns lol
            /*
            // FIXME is there ANY kind of hijinks i can do to allow loading a VN cross-domain without CORS?
            let root = 'res/prompt2-itchyitchy-final/';
            let root_url = new URL(root, document.location);
            //root_url = new URL('https://apps.veekun.com/flora-cutscenes/res/prompt2-itchyitchy-final/');
            let library = new Gleam.RemoteAssetLibrary(root_url);
            let xhr = new XMLHttpRequest;
            xhr.addEventListener('load', ev => {
                // FIXME handle errors yadda yadda
                let script = Gleam.MutableScript.from_legacy_json(JSON.parse(xhr.responseText));
                editor.load_script(script, library);
            });
            // XXX lol
            xhr.open('GET', new URL('script.json', root_url));
            xhr.send();
            */
        });
    </script>
</body>
</html>
